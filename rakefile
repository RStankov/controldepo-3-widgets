require 'erb'
require 'rake'

TESTS = 'tests/unit/';
TTEMPLATES = 'tests/templates/';

namespace :test do
	desc 'Create new unit test'
	task :create do
		test = ENV['name']
		title = ENV.include?('title') ? ENV['title'] : test
		File.open(TESTS + test + '.html', 'w+') do |file|
			template = ERB.new(IO.read(TTEMPLATES + 'test_case.erb'))
			file.puts template.result(binding)
		end
		puts 'template created'
		
		Rake.application['test:update'].invoke
	end
	
	task :update do
		testcases = FileList[TESTS + '*.html'].map { |n| File.basename(n, '.html') };
		
		File.open('tests/tests.html', 'w+') do |file|
			template = ERB.new(IO.read(TTEMPLATES + 'tests.erb'))
			file.puts template.result(binding)
		end
		
		puts 'tests menu updated'
	end
end
